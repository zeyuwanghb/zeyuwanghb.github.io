---
layout: post
title:  "[转]三次握手、四次挥手 "
categories: 计算机网络
tags:    计算机网络
author: ZyWang
excerpt: 计算机网络 
---

****

## ARP协议的工作原理 ##

网络层的ARP协议完成了Ip地址与物理地址的映射。首先，每台主机都在自己的ARP缓冲区中建立一个ARP列表，以表示IP和MAC地址的映射关系。当源主机需要将一个数据包发送到目的主机时，会首先检查自己的ARP列表有没有存在该IP对应的MAC地址，如果由就将数据包发送到这个MAC地址，如果没有，就向本地网段发送一个广播包，查询此目的主机对应的MAC地址。

此ARP请求数据包中包括源主机的IP地址、硬件地址、以及目的主机的IP地址。网络中的主机收到此ARP请求后，会检查数据包中的目的IP是否和自己的IP一样，如果不同就忽略此数据包，如果相同，该主机首先将发送端的MAC地址和IP添加到自己的缓冲区中，然后给源主机发送一个ARP响应包，告诉对方自己是需要查找的MAC地址，源主机收到后，开始数据传输。

## TCP主要特点 ##

1.TCP是面向连接的，数据传输前需要先建立连接，数据传输结束后需要释放连接。

2.每一条TCP连接是点对点的，只有两个端点。

3.TCP提供可靠的传输，通过TCP传输的数据，无差错、不丢失、不重复，并且按序到达。

4.TCP提供全双工通信，允许通信双方的应用进程在任何时候都能发送数据。

5.面向字节流，TCP中的流Stream指的是TCP把应用程序交下来的数据看成是一连串的无结构的字节流。

## UDP主要特点 ##

1.UDP是无连接的

2.UDP支持一对一、一对多、多对一、多对多的交互通信。

3.UDP尽最大努力传输，不保证可靠传输，因此不需要维持复杂的链接状态。

4.UDP没有拥塞控制，因此网络拥塞不会使源主机的发送率降低，对实时很有用，如直播、实时视频等

5.UDP首部开销小，只有8个字节，TCP头部20个字节。

6.面向报文的

## TCP协议是如何保证可靠传输的 ##

1.数据包校验，CRC校验，目的是检查数据在传输过程中

2.对失序数据包重排序，IP数据报的到达可能会失序，因此TCP报文段的到达也可能会失序，TCP将对失序数据进行重排序，在交给应用层。

3.丢失重复数据，对于重复的数据能够丢弃。

4.应答机制，TCP收到发自TCP另一端的数据，将发送一个确认。

5.超时重发

6.流量控制，滑动窗口

7.拥塞控制

## 拥塞控制 ##

若对网络中某一资源的需求超过了该资源所能提供的能力，网络性能就会变坏，这种情况叫做网络拥塞。

TCP拥塞控制的四种算法

1.慢开始，发送方拥有一个拥塞窗口cwnd，最开始值为1，此时发送窗口的大小等于拥塞窗口，因此发送方只能发送一个数据报文段，接收方接收到之后，回复确认报文段，发送方收到后，将拥塞窗口+1，变为2。之后，发送方拥塞窗口由2到4，由4到8，指数增长，直到达到慢开始门限值之后，改用拥塞避免算法。

2.拥塞控制，也就死每个传输轮次，拥塞窗口cwnd只能线性加1，而不是指数增长，假设一直增加，直到达到上限后，报文丢失，可能发生阻塞，这时会将慢开始门限更新为发生拥塞时cwnd的一半，并重新从1开始。

3.块重传，假设发送的报文1，接收方收到，恢复确认，发送方在收到确认前，还可以将2发送出去，接收方收到，回复确认，在2号报文段到达发送方之前，发送方还可以将发送窗口内的3号数据报文段发送出去，假设该报文丢失，发送方便不会发送针对该报文的确认报文给发送方，发送方还可以将发送窗口内的4号数据报文段发送出去，接收方收到后，发现这不是按序到达的报文段，因此给发送方发送针对2号报文段的重复确认，表明我现在希望收到的是3号报文段，但是我没有收到3号报文段，而收到了未按序到达的报文段，发送方还可以将发送窗口中的5号报文段发送出去,接收方收到后，发现这不是按序到达的报文段，因此给发送方发送针对2号报文段的重复确认，表明我现在希望收到的是3号报文段，但是我没有收到3号报文段，而收到了未按序到达的报文段,，发送方还可以将发送窗口内的最后一个数据段即6号数据报文段发送出去，接收方收到后，发现这不是按序到达的报文段，因此给发送方发送针对2号报文段的重复确认，表明我现在希望收到的是3号报文段，但是我没有收到3号报文段，而收到了未按序到达的报文段，此时，发送方收到了**累计3个连续的针对2号报文段的重复确认**，立即重传3号报文段，接收方收到后，给发送方发回针对6号报文的确认，表明，序号到6为至的报文都收到了，这样就不会造成发送方对3号报文的超时重传，而是提早收到了重传。


4.快恢复，一旦收到3个重复确认，就知道只是丢失了部分报文段，不启动慢开始算法，而执行快恢复算法，将慢开始门限和拥塞窗口的值调整为当前一半，执行拥塞避免算法。

## 从输入url到页面加载发生了什么 ##

1.DNS解析，寻找哪台机器上有你需要的资源，域名映射成IP地址，是一个递归查询的过程，首先在本地域名服务器查询，如果没有，本地域名服务器会向根域名服务器发送请求，如果根域名服务器没有，本地域名服务器会向顶级域名服务器com方法请求，最终找到对应的域名服务器的ip，并将其缓存下来，网址真正的解析过程为:.->.com.->goole.com.->www.goole.com.

DNS缓存:浏览器缓存、系统缓存、路由器缓存、IPS服务器缓存、根域名缓存

DNS负载均衡，大型网站后面由成千上万的服务器，DNS可以返回一个合适的机器ip给用户，可根据机器负载量、距离用户的远近等，CDN就是利用DNS的重定向计数，返回一个跟用户最近的ip地址。

2.建立TCP连接，三次握手，浏览器获得域名对应的ip地址后，向服务器请求建立连接，利用ip协议在网络层发送数据，利用ospf协议寻找该ip地址的网段，对ip数据包进行路由选择，利用ARP协议寻找物理地址

3.发送HTTP请求，访问网页。

4.服务器处理请求并返回HTTP报文

5.浏览器渲染页面呈现给用户。

6.HTTP1.0释放请求，连接结束，使用短连接，HTTP1.1开始，默认使用长连接，用以保持连接特性，使用长连接HTTP协议，在响应头中加入这行代码Connection:Keep-alive，有一个保持时间，当一个网页打开完成时，TCP连接不会关闭，当用户再次访问时，会继续使用这一条连接。同时，HTTP请求支持只发送header而不发送body，先用header判断能否成功，再继续发送。而在2.0中，开始支持多路复用，同一个连接可以并发处理多个请求，将http数据包拆分为帧，并发有序发送，另一端重组。同时，支持服务端推送，当http请求到达后，除了返回数据外，害推送了额外的内容给用户，压缩请求头，占用空间更少。

**HTTPS**

HTTP协议是明文传输，随着人们对网络传输安全性的要求越来越高，HTTPS协议因此出现。SSL/TLS握手是为了安全的协商出一份对称加密的密钥。

SSL/TLS握手过程

1.Client Hello，客户端向服务端发送消息，包含一个客户端的随机数、客户端支持的加密Hash算法、版本等

2.Server Hello，服务端向客户端发送消息，从客户端支持的加密和Hash算法中选择一份，同时生成随机数2，此时服务端和客户端都有了随机数1和随机数2。

3.Certificate，服务端将自己的证书下发给客户端，客户端，CA认证的，通过存在系统中的CA公钥解密，得到服务端的公钥，同时生成随机数3，再用服务端公钥加密随机数3.

4.客户端根据服务端公钥生成了PreMaster Key，服务端用私钥解密出随机数3，至此，双方都用了随机数1 2 3，随机数做种子，两边在根据同样的算法生成一份密钥，使用这个密钥进行对称加密，传输数据。

**HTTP和HTTPS的区别**

1.开销，HTTPS协议是需要CA申请证书的，一搬需要缴费

2.端口不同，HTTP是80端口，HTTPS是443端口

3.资源消耗，HTTPS更大一些

4.安全性，HTTPS更安全

## GET和POST的区别 ##

本质都是HTTP请求，只不过作用上做了界定和适配，适用于不同的场景。

GET本质上是一次HTTP请求，POST先发请求头，拿到100的响应状态码后，再发请求体，实际上是两次请求。

GET一搬是从服务器获取资源，POST一般是用来更新资源。

GET是幂等的，即读取一个资源，不论读取多少次得到的结果都是相同的，POST不是幂等的，会改变服务器上的资源。

请求参数上，GET请求的数据会附在URL之后，请求头中，POST请求的数据置于请求报文的请求体中。

请求大小上，GET请求的长度受限于浏览器或服务器对URL的长度限制，而POST请求是没有限制的。

## HTTP的方法 ##

GET 获取资源

HEAD 获取报文首部，不返回报文实体主体部分

POST 传输实体主体

PUT 上传文件，由于自身不带验证机制，任何人都可以上传文件，存在安全问题

PATCH 对资源进行部分修改

TRACE 追踪路径 服务器将通信路径返回给客户端

CONNECT 要求在于服务器通信时建立隧道

## forward和redirect区别 ##

forward直接转发，redirect间接转发

直接转发，客户端和浏览器只发出一次请求，A找B借钱，B说没有，B去找C借钱，再把信息返回给A。间接转发，实际上是两次HTTP请求，A找B借钱，B说没有，让A去找C借钱。