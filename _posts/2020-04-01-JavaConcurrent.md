---
layout: post
title:  "Java并发(二)"
categories: Java并发
tags:   Java并发
author: ZyWang
excerpt: Java并发相关知识 
---


## synchronized ##


## volatile ##

volatile关键字用来保证有序性和可见性，不能保证原子性。

一旦一个共享变量(类的成员变量、类的静态成员变量)被volatile修饰之后，那么就具备了两层语义:

1.保证了不同线程对这个变量进行操作时的可见性，即一个线程修改了某个变量的值，此新值对于其他线程来讲是立即可见的。

2.禁止指令重排序(编译器底层优化，不保证执行顺序一致，但保证最终结果一致)。

原子性用juc包下的atomic包下的原子操作，本质是CAS

**volatile的原理和实现机制**

观察加入volatile关键字和没有加入volatile关键字时所生成的汇编代码，加入volatile关键字时，会多出一个lock前缀指令，相当于一个内存屏障。

内存屏障用来保证:

1.指令重排序时不会把其后面的指令排到内存屏障之前的位置，也不会把前面的指令排到内存屏障的后面，即在执行到内存屏障这条指令时，前面的操作都已经完成。

2.会强制将对缓存的修改操作立即写入主存。

3.如果是写操作，会导致其他CPU中对应的缓存行无效。