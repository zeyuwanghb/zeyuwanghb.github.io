---
layout: post
title:  "JVM(二)"
categories: Java虚拟机
tags:   JVM
author: ZyWang
excerpt: Java虚拟机知识 
---

##四种引用##

Java内存管理分为内存分配和内存回收，都不需要程序员来负责，垃圾回收的机制主要是看对象是否还被引用。

Java中提供这四种引用类型:强引用、软引用、弱引用、虚引用。

目的:让程序员通过代码的方式决定某些对象的生命周期；有利于JVM进行垃圾回收。

强引用:是指创建一个对象并把这个对象赋给一个引用变量。 最普通的new方式，或者String str="hello"，强引用有引用变量指向时永远不会被垃圾回收，JVM宁愿抛出OOM错误也不会回收这种对象。

如果想中断强引用和某个对象之间的关联，可以显示的将引用赋值为null，这样JVM就会再合适的时间回收该对象。

软引用:如果一个对象具有软引用，内存空间足够时，垃圾回收器就不会回收它。如果内存空间不足了，就会回收这些对象的内存，软引用可用来实现内存敏感的告诉缓存，比如网页缓存、图片缓存等，使用软引用可以防止内存泄漏，增强程序的健壮性。SoftReference的特点是此类的一个实例保存了一个Java对象的软引用后，在垃圾线程对这个对象回收前，SoftReference类提供get()方法返回Java对象的强引用。

另外，一旦垃圾回收线程回收该对象，get()方法将返回null。

弱引用:弱引用也是用来描述非必须对象的，当JVM进行垃圾回收时，无论内存是否充足，都会回收弱引用关联的对象，在Java中，用java.lang.ref.Reference类来表示。

不过要注意的是。这里所说的被弱引用关联的对象是指只有弱引用与之关联，如果存在强引用同时与之关联，则进行垃圾回收时也不会回收该对象(软引用也如此)。

弱引用可以和一个引用队列(Reference Queue)联合使用，如果弱引用所引用的对象被JVM回收，这个弱引用就会加入到与之关联的引用队列中。

虚引用:虚引用和之前的引用不同，它不影响对象的生命周期，在Java中用java.lang.ref.PhantomReference类表示。如果一个对象与虚引用关联，则跟没有引用与之关联一样，任何时候都可能被垃圾回收器回收。

虚引用必须和引用队列关联使用，在被回收之前，会被放入ReferenceQueue中，其他引用是JVM回收之后才放入Queue中的，虚引用被用于引用销毁前的处理工作，比Object类中的finalize()方法更灵活。

**WeakHashMap**

在Java集合中有一种特殊的Map类型-WeakHashMap，在这种Map中存放了键对象的弱引用，当一个键对象被垃圾回收器回收时，那么对应的值对象会从Map中删除，WeakHashMap能够节约存储空间，可用来缓存那些非必须存在的数据。

## JVM一些参数设置 ##

堆设置

-Xms:初始堆大小
-Xmx:最大堆大小
-XX:NewSize=n 年轻代大小

收集器设置

-XX:+UseSerialGC 设置串行收集器
-XX:+UseParallelGC 设置并行收集器
-XX:+UseConcMarkSweepGC 设置并发收集器